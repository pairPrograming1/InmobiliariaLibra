module.exports=[10575,a=>{"use strict";var b=a.i(13535),c=a.i(16602),d=a.i(90162),e=a.i(8810),f=a.i(50802);function g({className:a,type:c,...d}){return(0,b.jsx)("input",{type:c,"data-slot":"input",className:(0,f.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),...d})}a.i(10622);var h=a.i(85833),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((a,d)=>{let e=c.forwardRef((a,c)=>{let{asChild:e,...f}=a,g=e?h.Slot:d;return(0,b.jsx)(g,{...f,ref:c})});return e.displayName=`Primitive.${d}`,{...a,[d]:e}},{}),j=c.forwardRef((a,c)=>(0,b.jsx)(i.label,{...a,ref:c,onMouseDown:b=>{b.target.closest("button, input, select, textarea")||(a.onMouseDown?.(b),!b.defaultPrevented&&b.detail>1&&b.preventDefault())}}));function k({className:a,...c}){return(0,b.jsx)(j,{"data-slot":"label",className:(0,f.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...c})}function l({className:a,...c}){return(0,b.jsx)("textarea",{"data-slot":"textarea",className:(0,f.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...c})}j.displayName="Label";var m=a.i(88192),n=a.i(58384);function o(a,b,{checkForDefaultPrevented:c=!0}={}){return function(d){if(a?.(d),!1===c||!d.defaultPrevented)return b?.(d)}}function p(a){let b=c.useRef(a);return c.useEffect(()=>{b.current=a}),c.useMemo(()=>(...a)=>b.current?.(...a),[])}var q=globalThis?.document?c.useLayoutEffect:()=>{},r=a=>{var b;let d,e,{present:f,children:g}=a,h=function(a){var b,d;let[e,f]=c.useState(),g=c.useRef({}),h=c.useRef(a),i=c.useRef("none"),[j,k]=(b=a?"mounted":"unmounted",d={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},c.useReducer((a,b)=>d[a][b]??a,b));return c.useEffect(()=>{let a=s(g.current);i.current="mounted"===j?a:"none"},[j]),q(()=>{let b=g.current,c=h.current;if(c!==a){let d=i.current,e=s(b);a?k("MOUNT"):"none"===e||b?.display==="none"?k("UNMOUNT"):c&&d!==e?k("ANIMATION_OUT"):k("UNMOUNT"),h.current=a}},[a,k]),q(()=>{if(e){let a,b=e.ownerDocument.defaultView??window,c=c=>{let d=s(g.current).includes(c.animationName);if(c.target===e&&d&&(k("ANIMATION_END"),!h.current)){let c=e.style.animationFillMode;e.style.animationFillMode="forwards",a=b.setTimeout(()=>{"forwards"===e.style.animationFillMode&&(e.style.animationFillMode=c)})}},d=a=>{a.target===e&&(i.current=s(g.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",c),e.addEventListener("animationend",c),()=>{b.clearTimeout(a),e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",c),e.removeEventListener("animationend",c)}}k("ANIMATION_END")},[e,k]),{isPresent:["mounted","unmountSuspended"].includes(j),ref:c.useCallback(a=>{a&&(g.current=getComputedStyle(a)),f(a)},[])}}(f),i="function"==typeof g?g({present:h.isPresent}):c.Children.only(g),j=(0,n.useComposedRefs)(h.ref,(b=i,(e=(d=Object.getOwnPropertyDescriptor(b.props,"ref")?.get)&&"isReactWarning"in d&&d.isReactWarning)?b.ref:(e=(d=Object.getOwnPropertyDescriptor(b,"ref")?.get)&&"isReactWarning"in d&&d.isReactWarning)?b.props.ref:b.props.ref||b.ref));return"function"==typeof g||h.isPresent?c.cloneElement(i,{ref:j}):null};function s(a){return a?.animationName||"none"}r.displayName="Presence";var t="Checkbox",[u,v]=function(a,d=[]){let e=[],f=()=>{let b=e.map(a=>c.createContext(a));return function(d){let e=d?.[a]||b;return c.useMemo(()=>({[`__scope${a}`]:{...d,[a]:e}}),[d,e])}};return f.scopeName=a,[function(d,f){let g=c.createContext(f),h=e.length;e=[...e,f];let i=d=>{let{scope:e,children:f,...i}=d,j=e?.[a]?.[h]||g,k=c.useMemo(()=>i,Object.values(i));return(0,b.jsx)(j.Provider,{value:k,children:f})};return i.displayName=d+"Provider",[i,function(b,e){let i=e?.[a]?.[h]||g,j=c.useContext(i);if(j)return j;if(void 0!==f)return f;throw Error(`\`${b}\` must be used within \`${d}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let d=()=>{let d=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let e=d.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return c.useMemo(()=>({[`__scope${b.scopeName}`]:e}),[e])}};return d.scopeName=b.scopeName,d}(f,...d)]}(t),[w,x]=u(t),y=c.forwardRef((a,d)=>{let{__scopeCheckbox:e,name:f,checked:g,defaultChecked:h,required:j,disabled:k,value:l="on",onCheckedChange:m,form:q,...r}=a,[s,t]=c.useState(null),u=(0,n.useComposedRefs)(d,a=>t(a)),v=c.useRef(!1),x=!s||q||!!s.closest("form"),[y=!1,z]=function({prop:a,defaultProp:b,onChange:d=()=>{}}){let[e,f]=function({defaultProp:a,onChange:b}){let d=c.useState(a),[e]=d,f=c.useRef(e),g=p(b);return c.useEffect(()=>{f.current!==e&&(g(e),f.current=e)},[e,f,g]),d}({defaultProp:b,onChange:d}),g=void 0!==a,h=g?a:e,i=p(d);return[h,c.useCallback(b=>{if(g){let c="function"==typeof b?b(a):b;c!==a&&i(c)}else f(b)},[g,a,f,i])]}({prop:g,defaultProp:h,onChange:m}),A=c.useRef(y);return c.useEffect(()=>{let a=s?.form;if(a){let b=()=>z(A.current);return a.addEventListener("reset",b),()=>a.removeEventListener("reset",b)}},[s,z]),(0,b.jsxs)(w,{scope:e,state:y,disabled:k,children:[(0,b.jsx)(i.button,{type:"button",role:"checkbox","aria-checked":C(y)?"mixed":y,"aria-required":j,"data-state":D(y),"data-disabled":k?"":void 0,disabled:k,value:l,...r,ref:u,onKeyDown:o(a.onKeyDown,a=>{"Enter"===a.key&&a.preventDefault()}),onClick:o(a.onClick,a=>{z(a=>!!C(a)||!a),x&&(v.current=a.isPropagationStopped(),v.current||a.stopPropagation())})}),x&&(0,b.jsx)(B,{control:s,bubbles:!v.current,name:f,value:l,checked:y,required:j,disabled:k,form:q,style:{transform:"translateX(-100%)"},defaultChecked:!C(h)&&h})]})});y.displayName=t;var z="CheckboxIndicator",A=c.forwardRef((a,c)=>{let{__scopeCheckbox:d,forceMount:e,...f}=a,g=x(z,d);return(0,b.jsx)(r,{present:e||C(g.state)||!0===g.state,children:(0,b.jsx)(i.span,{"data-state":D(g.state),"data-disabled":g.disabled?"":void 0,...f,ref:c,style:{pointerEvents:"none",...a.style}})})});A.displayName=z;var B=a=>{let d,{control:e,checked:f,bubbles:g=!0,defaultChecked:h,...i}=a,j=c.useRef(null),k=(d=c.useRef({value:f,previous:f}),c.useMemo(()=>(d.current.value!==f&&(d.current.previous=d.current.value,d.current.value=f),d.current.previous),[f])),l=function(a){let[b,d]=c.useState(void 0);return q(()=>{if(a){d({width:a.offsetWidth,height:a.offsetHeight});let b=new ResizeObserver(b=>{let c,e;if(!Array.isArray(b)||!b.length)return;let f=b[0];if("borderBoxSize"in f){let a=f.borderBoxSize,b=Array.isArray(a)?a[0]:a;c=b.inlineSize,e=b.blockSize}else c=a.offsetWidth,e=a.offsetHeight;d({width:c,height:e})});return b.observe(a,{box:"border-box"}),()=>b.unobserve(a)}d(void 0)},[a]),b}(e);c.useEffect(()=>{let a=j.current,b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(k!==f&&b){let c=new Event("click",{bubbles:g});a.indeterminate=C(f),b.call(a,!C(f)&&f),a.dispatchEvent(c)}},[k,f,g]);let m=c.useRef(!C(f)&&f);return(0,b.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:h??m.current,...i,tabIndex:-1,ref:j,style:{...a.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function C(a){return"indeterminate"===a}function D(a){return C(a)?"indeterminate":a?"checked":"unchecked"}var E=a.i(23013);let F=(0,E.default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);function G({className:a,...c}){return(0,b.jsx)(y,{"data-slot":"checkbox",className:(0,f.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...c,children:(0,b.jsx)(A,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,b.jsx)(F,{className:"size-3.5"})})})}let H=(0,E.default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var I=a.i(26405);let J=(0,E.default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var K=a.i(60447),L=a.i(70584);function M({property:a,onSubmit:f}){let h=(0,L.useRouter)(),[i,j]=(0,c.useState)(!1),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)({title:a?.title||"",description:a?.description||"",square_meters:a?.square_meters||0,rental_price:a?.rental_price||0,expenses:a?.expenses||0,rooms:a?.rooms||[{title:"",description:""}],service_ids:a?.services.map(a=>a.id)||[],images:a?.images||[]});(0,c.useEffect)(()=>{x(),a?.images&&u(a.images.map(a=>a.cloudinary_url))},[]);let x=async()=>{try{let a=await fetch("/api/services"),b=await a.json();q(b)}catch(a){console.error("[v0] Error fetching services:",a)}},y=async a=>{let b=a.target.files;if(b&&0!==b.length){if(v.images.length+b.length>10)return void alert("Máximo 10 imágenes permitidas");o(!0);try{let a=[];Array.from(b).forEach(b=>{let c=URL.createObjectURL(b);a.push(c)}),u(b=>[...b,...a]);let c=Array.from(b).map(async a=>{let b=new FormData;b.append("file",a);let c=await fetch("/api/upload",{method:"POST",body:b});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to upload image")}return await c.json()}),d=(await Promise.all(c)).map(a=>({cloudinary_url:a.secure_url,cloudinary_public_id:a.public_id}));w(a=>({...a,images:[...a.images,...d]})),u(b=>{let c=b.slice(0,b.length-a.length);return a.forEach(a=>URL.revokeObjectURL(a)),[...c,...d.map(a=>a.cloudinary_url)]})}catch(a){console.error("Error uploading images:",a),alert(`Error al subir im\xe1genes: ${a instanceof Error?a.message:"Error desconocido"}`),u(a=>a.slice(0,v.images.length))}finally{o(!1)}}},z=(a,b,c)=>{w(d=>({...d,rooms:d.rooms.map((d,e)=>e===a?{...d,[b]:c}:d)}))},A=async()=>{if(r.trim())try{let a=await fetch("/api/services",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r})});if(a.ok){let b=await a.json();q(a=>[...a,b]),w(a=>({...a,service_ids:[...a.service_ids,b.id]})),s("")}}catch(a){console.error("[v0] Error adding service:",a)}},B=async b=>{if(b.preventDefault(),!i){j(!0);try{let b=a?`/api/properties/${a.id}`:"/api/properties",c=a?"PUT":"POST",e=await fetch(b,{method:c,headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(e.ok)await d.default.fire({title:a?"Propiedad actualizada":"Propiedad creada",text:a?"Los cambios se guardaron correctamente.":"La propiedad se creó correctamente.",icon:"success",confirmButtonText:"Ver propiedades"}),a||(w({title:"",description:"",square_meters:0,rental_price:0,expenses:0,rooms:[{title:"",description:""}],service_ids:[],images:[]}),u([])),f&&f(),h.push("/propiedades");else{let a=await e.text().catch(()=>"");await d.default.fire({title:"Error",text:a||"Error al guardar la propiedad",icon:"error",confirmButtonText:"Entendido"})}}catch(a){console.error("[v0] Error submitting property:",a),await d.default.fire({title:"Error",text:"Hubo un problema al guardar la propiedad",icon:"error",confirmButtonText:"Entendido"})}finally{j(!1)}}};return(0,b.jsxs)("form",{onSubmit:B,className:"space-y-6",children:[(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsx)(m.CardTitle,{children:"Información General"})}),(0,b.jsxs)(m.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(k,{htmlFor:"title",children:"Título"}),(0,b.jsx)(g,{id:"title",value:v.title,onChange:a=>w({...v,title:a.target.value}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k,{htmlFor:"description",children:"Descripción"}),(0,b.jsx)(l,{id:"description",value:v.description,onChange:a=>w({...v,description:a.target.value}),rows:4})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(k,{htmlFor:"square_meters",children:"Metros Cuadrados"}),(0,b.jsx)(g,{id:"square_meters",type:"number",step:"0.01",value:v.square_meters,onChange:a=>w({...v,square_meters:Number.parseFloat(a.target.value)}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k,{htmlFor:"rental_price",children:"Precio de Alquiler"}),(0,b.jsx)(g,{id:"rental_price",type:"number",step:"0.01",value:v.rental_price,onChange:a=>w({...v,rental_price:Number.parseFloat(a.target.value)}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k,{htmlFor:"expenses",children:"Expensas"}),(0,b.jsx)(g,{id:"expenses",type:"number",step:"0.01",value:v.expenses,onChange:a=>w({...v,expenses:Number.parseFloat(a.target.value)})})]})]})]})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsx)(m.CardTitle,{children:"Imágenes (máximo 10)"})}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{children:(0,b.jsxs)(k,{htmlFor:"images",className:"cursor-pointer",children:[(0,b.jsx)("div",{className:"border-2 border-dashed border-border rounded-lg p-8 text-center hover:bg-muted/50 transition-colors",children:n?(0,b.jsx)(K.Loader2,{className:"h-8 w-8 animate-spin mx-auto text-muted-foreground"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J,{className:"h-8 w-8 mx-auto text-muted-foreground"}),(0,b.jsxs)("p",{className:"mt-2 text-sm text-muted-foreground",children:["Click para subir imágenes (",v.images.length,"/10)"]})]})}),(0,b.jsx)(g,{id:"images",type:"file",multiple:!0,accept:"image/*",onChange:y,className:"hidden",disabled:n||v.images.length>=10})]})}),t.length>0&&(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:t.map((a,c)=>(0,b.jsxs)("div",{className:"relative group",children:[(0,b.jsx)("img",{src:a||"/placeholder.svg",alt:`Imagen ${c+1}`,className:"w-full h-32 object-cover rounded-lg border-2 border-border"}),(0,b.jsx)("button",{type:"button",onClick:()=>{let a;return a=t[c],void(a?.startsWith("blob:")&&URL.revokeObjectURL(a),w(a=>({...a,images:a.images.filter((a,b)=>b!==c)})),u(a=>a.filter((a,b)=>b!==c)))},className:"absolute top-2 right-2 bg-destructive text-destructive-foreground rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)(I.X,{className:"h-4 w-4"})})]},c))})]})})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(m.CardTitle,{children:"Ambientes"}),(0,b.jsxs)(e.Button,{type:"button",onClick:()=>{w(a=>({...a,rooms:[...a.rooms,{title:"",description:""}]}))},size:"sm",variant:"outline",children:[(0,b.jsx)(H,{className:"h-4 w-4 mr-2"}),"Agregar Ambiente"]})]})}),(0,b.jsx)(m.CardContent,{className:"space-y-4",children:v.rooms.map((a,c)=>(0,b.jsxs)("div",{className:"border border-border rounded-lg p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h4",{className:"font-medium",children:["Ambiente ",c+1]}),v.rooms.length>1&&(0,b.jsx)(e.Button,{type:"button",onClick:()=>{w(a=>({...a,rooms:a.rooms.filter((a,b)=>b!==c)}))},size:"sm",variant:"ghost",children:(0,b.jsx)(I.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k,{htmlFor:`room-title-${c}`,children:"Título"}),(0,b.jsx)(g,{id:`room-title-${c}`,value:a.title,onChange:a=>z(c,"title",a.target.value),placeholder:"Ej: Dormitorio Principal",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(k,{htmlFor:`room-description-${c}`,children:"Descripción"}),(0,b.jsx)(l,{id:`room-description-${c}`,value:a.description,onChange:a=>z(c,"description",a.target.value),rows:2,placeholder:"Ej: Amplio dormitorio con placard empotrado"})]})]},c))})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsx)(m.CardTitle,{children:"Servicios"})}),(0,b.jsxs)(m.CardContent,{className:"space-y-4",children:[(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:p.map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(G,{id:`service-${a.id}`,checked:v.service_ids.includes(a.id),onCheckedChange:()=>{var b;return b=a.id,void w(a=>({...a,service_ids:a.service_ids.includes(b)?a.service_ids.filter(a=>a!==b):[...a.service_ids,b]}))}}),(0,b.jsx)(k,{htmlFor:`service-${a.id}`,className:"text-sm font-normal cursor-pointer",children:a.name})]},a.id))}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(g,{placeholder:"Otro servicio...",value:r,onChange:a=>s(a.target.value),onKeyDown:a=>{"Enter"===a.key&&(a.preventDefault(),A())}}),(0,b.jsx)(e.Button,{type:"button",onClick:A,variant:"outline",children:(0,b.jsx)(H,{className:"h-4 w-4"})})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(e.Button,{type:"submit",disabled:i,className:"flex-1",children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Guardando..."]}):(0,b.jsxs)(b.Fragment,{children:[a?"Actualizar":"Crear"," Propiedad"]})}),(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:()=>h.push("/admin"),disabled:i,children:"Cancelar"})]})]})}a.s(["PropertyForm",()=>M],10575)}];

//# sourceMappingURL=proyectos_InmobiliariaLibra_components_property-form_tsx_e5a57c28._.js.map